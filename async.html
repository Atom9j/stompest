

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Asynchronous Client &mdash; stompest documentation - v2.0a1</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '2.0a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="stompest documentation - v2.0a1" href="index.html" />
    <link rel="next" title="Protocol Layer" href="protocol.html" />
    <link rel="prev" title="Synchronous Client" href="sync.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="protocol.html" title="Protocol Layer"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sync.html" title="Synchronous Client"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">stompest documentation - v2.0a1</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Asynchronous Client</a><ul>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#producer">Producer</a></li>
<li><a class="reference internal" href="#transformer">Transformer</a></li>
<li><a class="reference internal" href="#consumer">Consumer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api">API</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="sync.html"
                        title="previous chapter">Synchronous Client</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="protocol.html"
                        title="next chapter">Protocol Layer</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/async.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-stompest.async.client">
<span id="asynchronous-client"></span><span id="async"></span><h1>Asynchronous Client<a class="headerlink" href="#module-stompest.async.client" title="Permalink to this headline">¶</a></h1>
<p>The asynchronous client is based on <a class="reference external" href="http://twistedmatrix.com/">Twisted</a>, a very mature and powerful asynchronous programming framework. It supports destination specific message and error handlers (with default &#8220;poison pill&#8221; error handling), concurrent message processing, graceful shutdown, and connect and disconnect timeouts.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://stomp.github.com/">STOMP protocol specification</a>, <a class="reference external" href="http://twistedmatrix.com/documents/current/api/">Twisted API documentation</a>, <a class="reference external" href="http://activemq.apache.org/stomp.html">Apache ActiveMQ - Stomp</a></p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="producer">
<h3>Producer<a class="headerlink" href="#producer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span><span class="p">,</span> <span class="n">reactor</span>

<span class="kn">from</span> <span class="nn">stompest.async</span> <span class="kn">import</span> <span class="n">Stomp</span>
<span class="kn">from</span> <span class="nn">stompest.protocol</span> <span class="kn">import</span> <span class="n">StompConfig</span>

<span class="k">class</span> <span class="nc">Producer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">QUEUE</span> <span class="o">=</span> <span class="s">&#39;/queue/testIn&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">StompConfig</span><span class="p">(</span><span class="s">&#39;tcp://localhost:61613&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        
    <span class="nd">@defer.inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">stomp</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">Stomp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">stomp</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">QUEUE</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&#39;count&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">}),</span> <span class="n">receipt</span><span class="o">=</span><span class="s">&#39;message-</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">stomp</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span> <span class="c"># graceful disconnect: waits until all receipts have arrived</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">Producer</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="transformer">
<h3>Transformer<a class="headerlink" href="#transformer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">stompest.async</span> <span class="kn">import</span> <span class="n">Stomp</span>
<span class="kn">from</span> <span class="nn">stompest.protocol</span> <span class="kn">import</span> <span class="n">StompConfig</span>

<span class="k">class</span> <span class="nc">IncrementTransformer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>    
    <span class="n">IN_QUEUE</span> <span class="o">=</span> <span class="s">&#39;/queue/testIn&#39;</span>
    <span class="n">OUT_QUEUE</span> <span class="o">=</span> <span class="s">&#39;/queue/testOut&#39;</span>
    <span class="n">ERROR_QUEUE</span> <span class="o">=</span> <span class="s">&#39;/queue/testTransformerError&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">StompConfig</span><span class="p">(</span><span class="s">&#39;tcp://localhost:61613&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        
    <span class="nd">@defer.inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">client</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">Stomp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c"># client-individual mode is necessary for concurrent processing</span>
            <span class="c"># (requires ActiveMQ &gt;= 5.2)</span>
            <span class="s">&#39;ack&#39;</span><span class="p">:</span> <span class="s">&#39;client-individual&#39;</span><span class="p">,</span>
            <span class="c"># the maximal number of messages the broker will let you work on at the same time</span>
            <span class="s">&#39;activemq.prefetchSize&#39;</span><span class="p">:</span> <span class="s">&#39;100&#39;</span><span class="p">,</span> 
        <span class="p">}</span>
        <span class="n">client</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IN_QUEUE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">addOne</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">errorDestination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ERROR_QUEUE</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">addOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        NOTE: you can return a Deferred here</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OUT_QUEUE</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">IncrementTransformer</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="consumer">
<h3>Consumer<a class="headerlink" href="#consumer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">stompest.async</span> <span class="kn">import</span> <span class="n">Stomp</span>
<span class="kn">from</span> <span class="nn">stompest.protocol</span> <span class="kn">import</span> <span class="n">StompConfig</span>

<span class="k">class</span> <span class="nc">Consumer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">QUEUE</span> <span class="o">=</span> <span class="s">&#39;/queue/testOut&#39;</span>
    <span class="n">ERROR_QUEUE</span> <span class="o">=</span> <span class="s">&#39;/queue/testConsumerError&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">StompConfig</span><span class="p">(</span><span class="s">&#39;tcp://localhost:61613&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        
    <span class="nd">@defer.inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">stomp</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">Stomp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c"># client-individual mode is necessary for concurrent processing</span>
            <span class="c"># (requires ActiveMQ &gt;= 5.2)</span>
            <span class="s">&#39;ack&#39;</span><span class="p">:</span> <span class="s">&#39;client-individual&#39;</span><span class="p">,</span>
            <span class="c"># the maximal number of messages the broker will let you work on at the same time</span>
            <span class="s">&#39;activemq.prefetchSize&#39;</span><span class="p">:</span> <span class="s">&#39;100&#39;</span><span class="p">,</span> 
        <span class="p">}</span>
        <span class="n">stomp</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">QUEUE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">errorDestination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ERROR_QUEUE</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">consume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        NOTE: you can return a Deferred here</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;Received frame with count </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;count&#39;</span><span class="p">]</span>
    
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">Consumer</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="stompest.async.client.Stomp">
<em class="property">class </em><tt class="descclassname">stompest.async.client.</tt><tt class="descname">Stomp</tt><big>(</big><em>config</em>, <em>receiptTimeout=None</em><big>)</big><a class="headerlink" href="#stompest.async.client.Stomp" title="Permalink to this definition">¶</a></dt>
<dd><p>An asynchronous STOMP client for the Twisted framework.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>config</strong> &#8211; A <a class="reference internal" href="protocol.html#stompest.protocol.failover.StompConfig" title="stompest.protocol.failover.StompConfig"><tt class="xref py py-class docutils literal"><span class="pre">StompConfig</span></tt></a> object.</li>
<li><strong>receiptTimeout</strong> &#8211; When a STOMP frame was sent to the broker and a <em>RECEIPT</em> frame was requested, this is the time (in seconds) to wait for the <em>RECEIPT</em> frame to arrive. If <tt class="xref py py-obj docutils literal"><span class="pre">None</span></tt>, we will wait indefinitely.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All API methods which may request a <em>RECEIPT</em> frame from the broker &#8211; which is indicated by the <em>receipt</em> parameter &#8211; will wait for the <em>RECEIPT</em> response until this client&#8217;s <em>receiptTimeout</em>. Here, &#8220;wait&#8221; is to be understood in the asynchronous sense that the method&#8217;s <tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.Deferred</span></tt> result will only call back then. If <em>receipt</em> is <tt class="xref py py-obj docutils literal"><span class="pre">None</span></tt>, no such header is sent, and the callback will be triggered earlier.</p>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="protocol.html#stompest.protocol.failover.StompConfig" title="stompest.protocol.failover.StompConfig"><tt class="xref py py-class docutils literal"><span class="pre">StompConfig</span></tt></a> for how to set session configuration options, <a class="reference internal" href="protocol.html#stompest.protocol.session.StompSession" title="stompest.protocol.session.StompSession"><tt class="xref py py-class docutils literal"><span class="pre">StompSession</span></tt></a> for session state, <a class="reference internal" href="protocol.html#module-stompest.protocol.commands" title="stompest.protocol.commands"><tt class="xref py py-mod docutils literal"><span class="pre">stompest.protocol.commands</span></tt></a> for all API options which are documented here.</p>
</div>
<dl class="method">
<dt id="stompest.async.client.Stomp.abort">
<tt class="descname">abort</tt><big>(</big><em>transaction=None</em>, <em>receipt=None</em><big>)</big><a class="headerlink" href="#stompest.async.client.Stomp.abort" title="Permalink to this definition">¶</a></dt>
<dd><p>Send an <em>ABORT</em> frame to abort a STOMP transaction. This method returns a <tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.Deferred</span></tt> object which will fire when a possibly requested <em>RECEIPT</em> frame has arrived.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.async.client.Stomp.ack">
<tt class="descname">ack</tt><big>(</big><em>frame</em>, <em>receipt=None</em><big>)</big><a class="headerlink" href="#stompest.async.client.Stomp.ack" title="Permalink to this definition">¶</a></dt>
<dd><p>Send an <em>ACK</em> frame for a received <em>MESSAGE</em> frame. This method returns a <tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.Deferred</span></tt> object which will fire when a possibly requested <em>RECEIPT</em> frame has arrived.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.async.client.Stomp.begin">
<tt class="descname">begin</tt><big>(</big><em>transaction=None</em>, <em>receipt=None</em><big>)</big><a class="headerlink" href="#stompest.async.client.Stomp.begin" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a <em>BEGIN</em> frame to begin a STOMP transaction. This method returns a <tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.Deferred</span></tt> object which will fire when a possibly requested <em>RECEIPT</em> frame has arrived.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.async.client.Stomp.commit">
<tt class="descname">commit</tt><big>(</big><em>transaction=None</em>, <em>receipt=None</em><big>)</big><a class="headerlink" href="#stompest.async.client.Stomp.commit" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a <em>COMMIT</em> frame to commit a STOMP transaction. This method returns a <tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.Deferred</span></tt> object which will fire when a possibly requested <em>RECEIPT</em> frame has arrived.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.async.client.Stomp.connect">
<tt class="descname">connect</tt><big>(</big><em>headers=None</em>, <em>versions=None</em>, <em>host=None</em>, <em>connectTimeout=None</em>, <em>connectedTimeout=None</em><big>)</big><a class="headerlink" href="#stompest.async.client.Stomp.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Establish a connection to a STOMP broker. If a network connect fails, attempt a failover according to the settings in the client&#8217;s <a class="reference internal" href="protocol.html#stompest.protocol.failover.StompConfig" title="stompest.protocol.failover.StompConfig"><tt class="xref py py-class docutils literal"><span class="pre">StompConfig</span></tt></a> object. If there are active subscriptions in the session, replay them when the STOMP session is established. This method returns a <tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.Deferred</span></tt> object which calls back with <tt class="xref py py-obj docutils literal"><span class="pre">self</span></tt> when the STOMP connection has been established and all subscriptions (if any) were replayed. In case of an error, it will err back with the reason of the failure.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>versions</strong> &#8211; The STOMP protocol versions we wish to support. The default behavior (<tt class="xref py py-obj docutils literal"><span class="pre">None</span></tt>) is the same as for the <a class="reference internal" href="protocol.html#stompest.protocol.commands.connect" title="stompest.protocol.commands.connect"><tt class="xref py py-func docutils literal"><span class="pre">connect()</span></tt></a> function of the commands API, but the highest supported version will be the one you specified in the <a class="reference internal" href="protocol.html#stompest.protocol.failover.StompConfig" title="stompest.protocol.failover.StompConfig"><tt class="xref py py-class docutils literal"><span class="pre">StompConfig</span></tt></a> object. The version which is valid for the connection about to be initiated will be stored in the client&#8217;s :class`~.session.StompSession` object (attribute <tt class="xref py py-attr docutils literal"><span class="pre">session</span></tt>).</li>
<li><strong>connectTimeout</strong> &#8211; This is the time (in seconds) to wait for the wire-level connection to be established. If <tt class="xref py py-obj docutils literal"><span class="pre">None</span></tt>, we will wait indefinitely.</li>
<li><strong>connectedTimeout</strong> &#8211; This is the time (in seconds) to wait for the STOMP connection to be established (that is, the broker&#8217;s <em>CONNECTED</em> frame to arrive). If <tt class="xref py py-obj docutils literal"><span class="pre">None</span></tt>, we will wait indefinitely.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only one connect attempt may be pending at a time. Any other attempt will result in a <tt class="xref py py-class docutils literal"><span class="pre">StompAlreadyRunningError</span></tt>.</p>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="protocol.html#module-stompest.protocol.failover" title="stompest.protocol.failover"><tt class="xref py py-mod docutils literal"><span class="pre">failover</span></tt></a>, <a class="reference internal" href="protocol.html#module-stompest.protocol.session" title="stompest.protocol.session"><tt class="xref py py-mod docutils literal"><span class="pre">session</span></tt></a> for the details of subscription replay and failover transport.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="stompest.async.client.Stomp.disconnect">
<tt class="descname">disconnect</tt><big>(</big><em>receipt=None</em>, <em>failure=None</em>, <em>timeout=None</em><big>)</big><a class="headerlink" href="#stompest.async.client.Stomp.disconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a <em>DISCONNECT</em> frame and terminate the STOMP connection. This method returns a <tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.Deferred</span></tt> object which calls back with <tt class="xref py py-obj docutils literal"><span class="pre">None</span></tt> when the STOMP connection has been closed. In case of a failure, it will err back with the failure reason.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>failure</strong> &#8211; A disconnect reason (a <tt class="xref py py-class docutils literal"><span class="pre">Exception</span></tt>) to err back. Example: <tt class="docutils literal"><span class="pre">versions=['1.0',</span> <span class="pre">'1.1']</span></tt></li>
<li><strong>timeout</strong> &#8211; This is the time (in seconds) to wait for a graceful disconnect, thas is, for pending message handlers to complete. If receipt is <tt class="xref py py-obj docutils literal"><span class="pre">None</span></tt>, we will wait indefinitely.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The session&#8217;s active subscriptions will be cleared if no failure has been passed to this method. This allows you to replay the subscriptions upon reconnect. If you do not wish to do so, you have to clear the subscriptions yourself by calling the <a class="reference internal" href="protocol.html#stompest.protocol.session.StompSession.close" title="stompest.protocol.session.StompSession.close"><tt class="xref py py-meth docutils literal"><span class="pre">close()</span></tt></a> method of the <tt class="xref py py-attr docutils literal"><span class="pre">session</span></tt> attribute. Only one disconnect attempt may be pending at a time. Any other attempt will result in a <tt class="xref py py-class docutils literal"><span class="pre">StompAlreadyRunningError</span></tt>. The result of any (user-requested or not) disconnect event is available via the <a class="reference internal" href="#stompest.async.client.Stomp.disconnected" title="stompest.async.client.Stomp.disconnected"><tt class="xref py py-attr docutils literal"><span class="pre">disconnected</span></tt></a> property.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="stompest.async.client.Stomp.disconnected">
<tt class="descname">disconnected</tt><a class="headerlink" href="#stompest.async.client.Stomp.disconnected" title="Permalink to this definition">¶</a></dt>
<dd><p>This <tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.Deferred</span></tt> calls back when the connection to the broker was lost. It will err back when the connection loss was unexpected or caused by another error.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.async.client.Stomp.nack">
<tt class="descname">nack</tt><big>(</big><em>frame</em>, <em>receipt=None</em><big>)</big><a class="headerlink" href="#stompest.async.client.Stomp.nack" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a <em>NACK</em> frame for a received <em>MESSAGE</em> frame. This method returns a <tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.Deferred</span></tt> object which will fire when a possibly requested <em>RECEIPT</em> frame has arrived.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.async.client.Stomp.send">
<tt class="descname">send</tt><big>(</big><em>destination</em>, <em>body=''</em>, <em>headers=None</em>, <em>receipt=None</em><big>)</big><a class="headerlink" href="#stompest.async.client.Stomp.send" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a <em>SEND</em> frame. This method returns a <tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.Deferred</span></tt> object which will fire when a possibly requested <em>RECEIPT</em> frame has arrived.</p>
</dd></dl>

<dl class="method">
<dt id="stompest.async.client.Stomp.sendFrame">
<tt class="descname">sendFrame</tt><big>(</big><em>frame</em><big>)</big><a class="headerlink" href="#stompest.async.client.Stomp.sendFrame" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a raw STOMP frame.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If we are not connected, this method, and all other API commands for sending STOMP frames except <a class="reference internal" href="#stompest.async.client.Stomp.connect" title="stompest.async.client.Stomp.connect"><tt class="xref py py-meth docutils literal"><span class="pre">connect()</span></tt></a>, will raise a <tt class="xref py py-class docutils literal"><span class="pre">StompConnectionError</span></tt>. Use this command only if you have to bypass the <tt class="xref py py-class docutils literal"><span class="pre">StompSession</span></tt> logic and you know what you&#8217;re doing!</p>
</div>
</dd></dl>

<dl class="method">
<dt id="stompest.async.client.Stomp.sendToErrorDestination">
<tt class="descname">sendToErrorDestination</tt><big>(</big><em>failure</em>, <em>frame</em>, <em>errorDestination</em><big>)</big><a class="headerlink" href="#stompest.async.client.Stomp.sendToErrorDestination" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the default error handler for failed <em>MESSAGE</em> handlers: forward the offending frame to the error destination (if given) and ack the frame. As opposed to earlier versions, It may be used as a building block for custom error handlers.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>failure</strong> &#8211; see the onMessageFailed argument of <a class="reference internal" href="#stompest.async.client.Stomp.subscribe" title="stompest.async.client.Stomp.subscribe"><tt class="xref py py-meth docutils literal"><span class="pre">subscribe()</span></tt></a>.</li>
<li><strong>frame</strong> &#8211; see the onMessageFailed argument of <a class="reference internal" href="#stompest.async.client.Stomp.subscribe" title="stompest.async.client.Stomp.subscribe"><tt class="xref py py-meth docutils literal"><span class="pre">subscribe()</span></tt></a>.</li>
<li><strong>errorDestination</strong> &#8211; see the onMessageFailed argument of <a class="reference internal" href="#stompest.async.client.Stomp.subscribe" title="stompest.async.client.Stomp.subscribe"><tt class="xref py py-meth docutils literal"><span class="pre">subscribe()</span></tt></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="stompest.async.client.Stomp.subscribe">
<tt class="descname">subscribe</tt><big>(</big><em>destination</em>, <em>handler</em>, <em>headers=None</em>, <em>receipt=None</em>, <em>ack=True</em>, <em>errorDestination=None</em>, <em>onMessageFailed=None</em><big>)</big><a class="headerlink" href="#stompest.async.client.Stomp.subscribe" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a <em>SUBSCRIBE</em> frame to subscribe to a STOMP destination. This method returns a <tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.Deferred</span></tt> object which will fire with a token when a possibly requested <em>RECEIPT</em> frame has arrived. This token is used internally to match incoming <em>MESSAGE</em> frames and must be kept if you wish to <a class="reference internal" href="#stompest.async.client.Stomp.unsubscribe" title="stompest.async.client.Stomp.unsubscribe"><tt class="xref py py-meth docutils literal"><span class="pre">unsubscribe()</span></tt></a> later.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>handler</strong> &#8211; A callable <tt class="xref py py-obj docutils literal"><span class="pre">f(client,</span> <span class="pre">frame)</span></tt> which accepts this client and the received <a class="reference internal" href="protocol.html#stompest.protocol.frame.StompFrame" title="stompest.protocol.frame.StompFrame"><tt class="xref py py-class docutils literal"><span class="pre">StompFrame</span></tt></a>.</li>
<li><strong>ack</strong> &#8211; Check this option if you wish the client to automatically ack MESSAGE frames when the were handled (successfully or not).</li>
<li><strong>errorDestination</strong> &#8211; If a frame was not handled successfully, forward a copy of the offending frame to this destination. Example: <tt class="docutils literal"><span class="pre">errorDestination='/queue/back-to-square-one'</span></tt></li>
<li><strong>onMessageFailed</strong> &#8211; You can specify a custom error handler which must be a callable with signature <tt class="xref py py-obj docutils literal"><span class="pre">f(self,</span> <span class="pre">failure,</span> <span class="pre">frame,</span> <span class="pre">errorDestination)</span></tt>. Note that a non-trivial choice of this error handler overrides the default behavior (forward frame to error destination and ack it).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As opposed to the behavior of stompest 1.x, the client will not disconnect when a message could not be handled. Rather, a disconnect will only be triggered in a &#8220;panic&#8221; situation when also the error handler failed. The automatic disconnect was partly a substitute for the missing NACK command in STOMP 1.0. If you wish to automatically disconnect, you have to implement the <strong>onMessageFailed</strong> hook.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="stompest.async.client.Stomp.unsubscribe">
<tt class="descname">unsubscribe</tt><big>(</big><em>token</em>, <em>receipt=None</em><big>)</big><a class="headerlink" href="#stompest.async.client.Stomp.unsubscribe" title="Permalink to this definition">¶</a></dt>
<dd><p>Send an <em>UNSUBSCRIBE</em> frame to terminate an existing subscription. This method returns a <tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.Deferred</span></tt> object which will fire when a possibly requested <em>RECEIPT</em> frame has arrived.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>token</strong> &#8211; The result of the <a class="reference internal" href="#stompest.async.client.Stomp.subscribe" title="stompest.async.client.Stomp.subscribe"><tt class="xref py py-meth docutils literal"><span class="pre">subscribe()</span></tt></a> command which initiated the subscription in question.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="protocol.html" title="Protocol Layer"
             >next</a> |</li>
        <li class="right" >
          <a href="sync.html" title="Synchronous Client"
             >previous</a> |</li>
        <li><a href="index.html">stompest documentation - v2.0a1</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Roger Hoover, Jan Müller.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>